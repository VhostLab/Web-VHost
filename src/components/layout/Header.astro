---
import vhostLogo from '/src/images/vhosthostingservices.webp';
import discordIcon from '/src/images/discord-icon.webp';
import twitterIcon from '/src/images/twitter-icon.webp';
import emailIcon from '/src/images/email-icon.webp';


const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 transition-all duration-300" id="main-header">
  <!-- Redes sociales -->
  <div class="bg-primary py-2 transition-all duration-300" id="social-bar">
    <div class="container mx-auto flex justify-center md:justify-start px-6">
      <div class="flex space-x-3">
        <a href="https://discord.gg/Ykr85wevrj" class="group" aria-label="Discord">
          <img src={discordIcon.src} alt="Discord"
            class="h-4 w-4 filter brightness-0 invert transition duration-200
                   group-hover:invert-0 group-hover:brightness-75
                   group-hover:sepia group-hover:saturate-200 group-hover:hue-rotate-15" />
        </a>
        <a href="https://x.com/VhostTS3" class="group" aria-label="Twitter">
          <img src={twitterIcon.src} alt="Twitter"
            class="h-4 w-4 filter brightness-0 invert transition duration-200
                   group-hover:invert-0 group-hover:brightness-75
                   group-hover:sepia group-hover:saturate-200 group-hover:hue-rotate-15" />
        </a>
        <a href="mailto:vhostts3@gmail.com" class="group" aria-label="Email">
          <img src={emailIcon.src} alt="Email"
            class="h-4 w-4 filter brightness-0 invert transition duration-200
                   group-hover:invert-0 group-hover:brightness-75
                   group-hover:sepia group-hover:saturate-200 group-hover:hue-rotate-15" />
        </a>
      </div>
    </div>
  </div>

  <!-- Header principal -->
  <div class="bg-secondary transition-all duration-300" id="main-nav">
    <div class="container mx-auto flex items-center justify-between py-4 px-6 lg:px-12">
      <!-- Logo -->
      <a href="/" class="block">
        <img src={vhostLogo.src} alt="VHost Logo" class="h-14 w-auto" />
      </a>

      <!-- Menú móvil -->
      <button
        id="mobile-menu-button"
        class="md:hidden text-white focus:outline-none"
        aria-label="Abrir menú"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Navegación escritorio -->
      <nav class="hidden md:flex items-center space-x-6">
        <ul class="flex space-x-2 items-center">
          <li><a href="/" class="text-lg font-poppins font-bold text-white">INICIO</a></li>
          <li class="relative group" tabindex="0">
<li class="relative group" tabindex="0">
  <button
    class="text-lg font-poppins font-bold text-white px-3 py-1 flex items-center focus:outline-none"
    aria-haspopup="true"
    aria-expanded="false"
  >
    TIENDA
    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>
  <ul
    class="absolute left-0 top-full mt-0 w-auto min-w-[500px]
           bg-gradient-to-r from-[#101010]/90 to-[#000000]/90
           rounded-lg shadow-lg z-50 border border-white/20 backdrop-blur-sm
           invisible opacity-0
           group-hover:visible group-hover:opacity-100
           hover:visible hover:opacity-100
           focus-within:visible focus-within:opacity-100
           transition duration-200 whitespace-nowrap overflow-hidden
           flex flex-row gap-8 p-6"
  >
    <!-- Columna Game Hosting (dos columnas usando flex) -->
    <div>
      <span class="px-2 pb-2 text-xs uppercase tracking-wider text-gray-400 font-bold block mb-2">Game Hosting</span>
      <div class="flex flex-row gap-8">
        <div class="flex flex-col min-w-[140px]">
          <a href="/tienda/minecraft"
            class="flex items-center px-2 py-2 text-sm font-semibold text-white hover:bg-white/10 rounded whitespace-nowrap"
          >Minecraft</a>
          <a href="/tienda/ark"
            class="flex items-center px-2 py-2 text-sm font-semibold text-white hover:bg-white/10 rounded whitespace-nowrap"
          >Ark Survival Evolved</a>
        </div>
        <div class="flex flex-col min-w-[100px]">
          <a href="/tienda/rust"
            class="flex items-center px-2 py-2 text-sm font-semibold text-white hover:bg-white/10 rounded whitespace-nowrap"
          >Rust</a>
          <a href="/tienda/gta5"
            class="flex items-center px-2 py-2 text-sm font-semibold text-white hover:bg-white/10 rounded whitespace-nowrap"
          >GTA 5</a>
        </div>
      </div>
    </div>
    <!-- Divider -->
    <div class="w-px bg-white/10 mx-2"></div>
    <!-- Columna Other Services -->
    <div class="flex flex-col min-w-[160px]">
      <span class="px-2 pb-2 text-xs uppercase tracking-wider text-gray-400 font-bold mb-2">Other Services</span>
      <a href="/tienda/teamspeak3"
        class="flex items-center px-2 py-2 text-sm font-semibold text-white hover:bg-white/10 rounded whitespace-nowrap"
      >Teamspeak 3</a>
    </div>
  </ul>
</li>




          <li><a href="/partners" class="text-lg font-poppins font-bold text-white">PARTNERS</a></li>
        </ul>
        <ul class="flex space-x-6 items-center">
          <li><a href="/soporte" class="text-lg font-poppins font-extrabold px-3 py-1 text-white">SOPORTE</a></li>
          <li class="relative group" tabindex="0">
            <button
              class="text-lg font-poppins font-extrabold text-white
                     bg-gradient-to-r from-[#101010] to-[#000000]
                     rounded-md px-3 py-1 flex items-center focus:outline-none"
            >
              CLIENTES
              <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <ul
              class="absolute right-0 top-full mt-0 w-56
                     bg-gradient-to-r from-[#101010]/90 to-[#000000]/90
                     rounded-lg shadow-lg z-50 border border-white/20 backdrop-blur-sm
                     invisible opacity-0
                     group-hover:visible group-hover:opacity-100
                     hover:visible    hover:opacity-100
                     focus-within:visible focus-within:opacity-100
                     transition duration-200 whitespace-nowrap overflow-hidden"
            >
              <li>
                <a href="https://billing.vhost.tech" target="_blank"
                   class="flex items-center px-4 py-2 text-sm font-semibold text-white"
                >
                  <i class="fas fa-user-cog w-4 h-4 mr-2"></i>Área de Clientes
                </a>
              </li>
              <li>
                <a href="https://panel.vhost.tech" target="_blank"
                   class="flex items-center px-4 py-2 text-sm font-semibold text-white"
                >
                  <i class="fas fa-gamepad w-4 h-4 mr-2"></i>Panel Juegos
                </a>
              </li>
              <li>
                <a href="https://status.vhost.tech" target="_blank"
                   class="flex items-center px-4 py-2 text-sm font-semibold text-white"
                >
                  <i class="fas fa-server w-4 h-4 mr-2"></i>Estado de los servidores
                </a>
              </li>
              <li>
                <a href="https://discord.gg/Ykr85wevrj" target="_blank"
                   class="flex items-center px-4 py-2 text-sm font-semibold text-white"
                >
                  <i class="fab fa-discord w-4 h-4 mr-2"></i>Discord
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Menú móvil desplegable -->
  <div
    id="mobile-menu"
    class="md:hidden bg-primary/95 backdrop-blur-sm border-t border-secondary/20 overflow-hidden transition-all duration-300 max-h-0"
  >
    <nav class="container mx-auto px-6 py-0">
      <ul class="space-y-1">
        <li>
          <a href="/" class="block py-3 text-white font-bold border-b border-secondary/10">INICIO</a>
        </li>
        <li>
          <button
            id="mobile-tienda-toggle"
            class="w-full flex items-center justify-between py-3 text-white font-bold border-b border-secondary/10"
          >
            TIENDA
            <svg class="w-4 h-4 transition-transform" id="mobile-tienda-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <ul id="mobile-tienda-submenu" class="overflow-hidden transition-all duration-300 max-h-0 bg-black/20">
            <li><a href="/tienda/minecraft" class="block py-2 pl-4 text-sm text-white">Minecraft</a></li>
            <li><a href="/tienda/ark" class="block py-2 pl-4 text-sm text-white">Ark Survival Evolved</a></li>
            <li><a href="/tienda/rust" class="block py-2 pl-4 text-sm text-white">Rust</a></li>
            <li><a href="/tienda/gta5" class="block py-2 pl-4 text-sm text-white">GTA 5</a></li>
            <li><a href="/tienda/teamspeak3" class="block py-2 pl-4 text-sm text-white border-b border-secondary/10">Teamspeak 3</a></li>
          </ul>
        </li>
        <li>
          <a href="/partners" class="block py-3 text-white font-bold border-b border-secondary/10">PARTNERS</a>
        </li>
        <li>
          <a href="/soporte" class="block py-3 text-white font-bold border-b border-secondary/10">SOPORTE</a>
        </li>
        <li>
          <button
            id="mobile-clientes-toggle"
            class="w-full flex items-center justify-between py-3 text-white font-bold border-b border-secondary/10"
          >
            CLIENTES
            <svg class="w-4 h-4 transition-transform" id="mobile-clientes-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <ul id="mobile-clientes-submenu" class="overflow-hidden transition-all duration-300 max-h-0 bg-black/20">
            <li><a href="https://billing.vhost.tech" target="_blank" class="block py-2 pl-4 text-sm text-white">Área de Clientes</a></li>
            <li><a href="https://panel.vhost.tech" target="_blank" class="block py-2 pl-4 text-sm text-white">Panel Juegos</a></li>
            <li><a href="https://status.vhost.tech" target="_blank" class="block py-2 pl-4 text-sm text-white">Estado de los servidores</a></li>
            <li><a href="https://discord.gg/Ykr85wevrj" target="_blank" class="block py-2 pl-4 text-sm text-white border-b border-secondary/10">Discord</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>

<script>
  // Efecto sticky header con blur y transparencia al hacer scroll
  let lastScroll = 0;
  const header = document.getElementById('main-header');
  const mainNav = document.getElementById('main-nav');
  const socialBar = document.getElementById('social-bar');

  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;

    if (currentScroll > 50) {
      // Cuando scroll > 50px: ocultar social bar, añadir blur y sombra
      if (socialBar) socialBar.style.display = 'none';
      if (mainNav) {
        mainNav.style.backdropFilter = 'blur(10px)';
        mainNav.style.backgroundColor = 'rgba(252, 124, 4, 0.95)';
        mainNav.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.3)';
      }
    } else {
      // Cuando scroll < 50px: mostrar social bar, remover blur
      if (socialBar) socialBar.style.display = 'block';
      if (mainNav) {
        mainNav.style.backdropFilter = 'none';
        mainNav.style.backgroundColor = '';
        mainNav.style.boxShadow = 'none';
      }
    }

    lastScroll = currentScroll;
  });

  // Menú móvil
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  let menuOpen = false;

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', (e) => {
      e.stopPropagation();
      menuOpen = !menuOpen;

      if (menuOpen) {
        mobileMenu.style.maxHeight = '800px';
        mobileMenu.style.paddingTop = '8px';
        mobileMenu.style.paddingBottom = '8px';
      } else {
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.paddingTop = '0px';
        mobileMenu.style.paddingBottom = '0px';
      }
    });

    // Cerrar menú al hacer clic en un enlace (excepto los botones de submenú)
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        menuOpen = false;
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.paddingTop = '0px';
        mobileMenu.style.paddingBottom = '0px';
      });
    });
  }

  // Submenú móvil - Tienda
  const tiendaToggle = document.getElementById('mobile-tienda-toggle');
  const tiendaSubmenu = document.getElementById('mobile-tienda-submenu');
  const tiendaArrow = document.getElementById('mobile-tienda-arrow');

  if (tiendaToggle && tiendaSubmenu) {
    tiendaToggle.addEventListener('click', () => {
      if (tiendaSubmenu.style.maxHeight === '0px' || tiendaSubmenu.style.maxHeight === '') {
        tiendaSubmenu.style.maxHeight = '300px';
        if (tiendaArrow) tiendaArrow.style.transform = 'rotate(180deg)';
      } else {
        tiendaSubmenu.style.maxHeight = '0px';
        if (tiendaArrow) tiendaArrow.style.transform = 'rotate(0deg)';
      }
    });
  }

  // Submenú móvil - Clientes
  const clientesToggle = document.getElementById('mobile-clientes-toggle');
  const clientesSubmenu = document.getElementById('mobile-clientes-submenu');
  const clientesArrow = document.getElementById('mobile-clientes-arrow');

  if (clientesToggle && clientesSubmenu) {
    clientesToggle.addEventListener('click', () => {
      if (clientesSubmenu.style.maxHeight === '0px' || clientesSubmenu.style.maxHeight === '') {
        clientesSubmenu.style.maxHeight = '250px';
        if (clientesArrow) clientesArrow.style.transform = 'rotate(180deg)';
      } else {
        clientesSubmenu.style.maxHeight = '0px';
        if (clientesArrow) clientesArrow.style.transform = 'rotate(0deg)';
      }
    });
  }
</script>

<style>
  /* Active state para navegación */
  nav a[href]:not([target="_blank"]) {
    position: relative;
  }

  nav a[href]:not([target="_blank"])::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: white;
    transition: width 0.3s ease;
  }

  nav a[href]:not([target="_blank"]):hover::after {
    width: 100%;
  }
</style>
